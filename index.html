<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4299e1, #38b2ac);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .header-desc {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        /* 登录注册面板样式 */
        .auth-panel {
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .auth-card {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 30px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: #4299e1;
            border-bottom: 2px solid #4299e1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            margin-top: 10px;
        }
        
        .btn-secondary:hover {
            background: #edf2f7;
        }
        
        .error-message {
            color: #e53e3e;
            margin-bottom: 15px;
            text-align: center;
            height: 20px;
        }
        
        /* 主功能区样式 */
        .main-content {
            display: none;
        }
        
        .nav-bar {
            display: flex;
            background: #4a5568;
            padding: 0 20px;
        }
        
        .nav-item {
            padding: 15px 20px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #2d3748;
        }
        
        .content-panel {
            padding: 30px;
            display: none;
        }
        
        .content-panel.active {
            display: block;
        }
        
        .panel-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .panel-title {
            font-size: 1.5rem;
            color: #2d3748;
        }
        
        /* 密码修改样式 */
        .change-pwd-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* 成绩管理样式 */
        .score-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .select-control {
            flex: 1;
            min-width: 200px;
        }
        
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background: white;
        }
        
        .btn-sm {
            padding: 8px 15px;
            width: auto;
        }
        
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .score-table th, .score-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .score-table th {
            background: #f7fafc;
            font-weight: bold;
            color: #2d3748;
        }
        
        .score-table tr:hover {
            background: #fafafa;
        }
        
        .excellent {
            color: #48bb78;
            font-weight: bold;
        }
        
        .failed {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .average {
            color: #ed8936;
        }
        
        .stat-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-item {
            flex: 1;
            min-width: 150px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4299e1;
            margin: 5px 0;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }
        
        /* 添加成绩表单 */
        .add-score-form {
            max-width: 800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        /* 响应式样式 */
        @media (max-width: 768px) {
            .nav-bar {
                flex-direction: column;
            }
            
            .nav-item {
                text-align: center;
            }
            
            .score-controls {
                flex-direction: column;
            }
            
            .stat-card {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>学生成绩管理系统</h1>
            <p class="header-desc">一站式学生成绩录入、统计与分析平台</p>
        </header>

        <!-- 登录注册面板 -->
        <div class="auth-panel" id="authPanel">
            <div class="auth-card">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">登录</div>
                    <div class="auth-tab" data-tab="register">注册</div>
                </div>
                <div class="error-message" id="errorMsg"></div>
                
                <!-- 登录表单 -->
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">用户名</label>
                        <input type="text" id="loginUsername" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">密码</label>
                        <input type="password" id="loginPassword" required placeholder="请输入密码">
                    </div>
                    <button type="submit" class="btn btn-primary">登录</button>
                </form>
                
                <!-- 注册表单 -->
                <form id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label for="regUsername">用户名</label>
                        <input type="text" id="regUsername" required placeholder="请设置用户名">
                    </div>
                    <div class="form-group">
                        <label for="regPassword">密码</label>
                        <input type="password" id="regPassword" required placeholder="请设置密码（不少于6位）">
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPwd">确认密码</label>
                        <input type="password" id="regConfirmPwd" required placeholder="请再次输入密码">
                    </div>
                    <button type="submit" class="btn btn-primary">注册</button>
                </form>
            </div>
        </div>

        <!-- 主功能区 -->
        <div class="main-content" id="mainContent">
            <div class="nav-bar">
                <div class="nav-item active" data-panel="changePwd">修改密码</div>
                <div class="nav-item" data-panel="addScore">添加成绩</div>
                <div class="nav-item" data-panel="classStat">班级成绩统计</div>
                <div class="nav-item" data-panel="scoreFilter">成绩筛选</div>
                <div class="nav-item" id="logoutBtn">退出登录</div>
            </div>

            <!-- 修改密码面板 -->
            <div class="content-panel active" id="changePwdPanel">
                <div class="panel-header">
                    <h2 class="panel-title">修改密码</h2>
                </div>
                <form class="change-pwd-form" id="changePwdForm">
                    <div class="form-group">
                        <label for="oldPassword">原密码</label>
                        <input type="password" id="oldPassword" required placeholder="请输入原密码">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">新密码</label>
                        <input type="password" id="newPassword" required placeholder="请输入新密码（不少于6位）">
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPwd">确认新密码</label>
                        <input type="password" id="confirmNewPwd" required placeholder="请再次输入新密码">
                    </div>
                    <button type="submit" class="btn btn-primary">提交修改</button>
                </form>
            </div>

            <!-- 添加成绩面板 -->
            <div class="content-panel" id="addScorePanel">
                <div class="panel-header">
                    <h2 class="panel-title">添加学生成绩</h2>
                </div>
                <form class="add-score-form" id="addScoreForm">
                    <div class="form-group">
                        <label for="studentName">学生姓名</label>
                        <input type="text" id="studentName" required placeholder="请输入学生姓名">
                    </div>
                    <div class="form-group">
                        <label for="studentClass">班级</label>
                        <input type="text" id="studentClass" required placeholder="如：2023级1班">
                    </div>
                    <div class="form-group">
                        <label for="subject">科目</label>
                        <select id="subject" required>
                            <option value="">请选择科目</option>
                            <option value="语文">语文</option>
                            <option value="数学">数学</option>
                            <option value="英语">英语</option>
                            <option value="物理">物理</option>
                            <option value="化学">化学</option>
                            <option value="生物">生物</option>
                            <option value="政治">政治</option>
                            <option value="历史">历史</option>
                            <option value="地理">地理</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="score">成绩</label>
                        <input type="number" id="score" required min="0" max="100" placeholder="请输入0-100的成绩">
                    </div>
                    <div class="form-group full-width">
                        <button type="submit" class="btn btn-primary btn-sm">添加成绩</button>
                        <button type="reset" class="btn btn-secondary btn-sm">重置</button>
                    </div>
                </form>
            </div>

            <!-- 班级成绩统计面板 -->
            <div class="content-panel" id="classStatPanel">
                <div class="panel-header">
                    <h2 class="panel-title">班级各科成绩统计</h2>
                </div>
                <div class="score-controls">
                    <div class="select-control">
                        <label for="statClass">选择班级</label>
                        <select id="statClass" required>
                            <option value="">请选择班级</option>
                        </select>
                    </div>
                    <button class="btn btn-primary btn-sm" id="statBtn">查询统计</button>
                </div>
                <div class="stat-card" id="statResult" style="display: none;">
                    <!-- 统计结果将通过JS动态生成 -->
                </div>
                <table class="score-table" id="classScoreTable">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>学生姓名</th>
                            <th>科目</th>
                            <th>成绩</th>
                            <th>等级</th>
                        </tr>
                    </thead>
                    <tbody id="classScoreBody">
                        <tr>
                            <td colspan="5" style="color: #718096;">请选择班级并点击查询统计</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 成绩筛选面板 -->
            <div class="content-panel" id="scoreFilterPanel">
                <div class="panel-header">
                    <h2 class="panel-title">成绩筛选（优秀/不合格）</h2>
                </div>
                <div class="score-controls">
                    <div class="select-control">
                        <label for="filterType">筛选类型</label>
                        <select id="filterType" required>
                            <option value="excellent">优秀学生（≥85分）</option>
                            <option value="failed">不合格学生（<60分）</option>
                        </select>
                    </div>
                    <div class="select-control">
                        <label for="filterSubject">选择科目</label>
                        <select id="filterSubject" required>
                            <option value="">请选择科目</option>
                            <option value="语文">语文</option>
                            <option value="数学">数学</option>
                            <option value="英语">英语</option>
                            <option value="物理">物理</option>
                            <option value="化学">化学</option>
                            <option value="生物">生物</option>
                            <option value="政治">政治</option>
                            <option value="历史">历史</option>
                            <option value="地理">地理</option>
                        </select>
                    </div>
                    <button class="btn btn-primary btn-sm" id="filterBtn">筛选</button>
                </div>
                <table class="score-table" id="filterResultTable">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>学生姓名</th>
                            <th>班级</th>
                            <th>科目</th>
                            <th>成绩</th>
                        </tr>
                    </thead>
                    <tbody id="filterResultBody">
                        <tr>
                            <td colspan="5" style="color: #718096;">请选择筛选条件并点击筛选</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 初始化数据存储结构
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify({}));
        }
        if (!localStorage.getItem('scores')) {
            localStorage.setItem('scores', JSON.stringify([]));
        }

        // DOM元素
        const authPanel = document.getElementById('authPanel');
        const mainContent = document.getElementById('mainContent');
        const errorMsg = document.getElementById('errorMsg');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const changePwdForm = document.getElementById('changePwdForm');
        const addScoreForm = document.getElementById('addScoreForm');
        const statBtn = document.getElementById('statBtn');
        const filterBtn = document.getElementById('filterBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const statClassSelect = document.getElementById('statClass');
        const statResult = document.getElementById('statResult');
        const classScoreBody = document.getElementById('classScoreBody');
        const filterResultBody = document.getElementById('filterResultBody');

        // 登录注册切换
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const tabType = tab.dataset.tab;
                if (tabType === 'login') {
                    loginForm.style.display = 'block';
                    registerForm.style.display = 'none';
                } else {
                    loginForm.style.display = 'none';
                    registerForm.style.display = 'block';
                }
                errorMsg.textContent = '';
            });
        });

        // 导航切换
        document.querySelectorAll('.nav-item').forEach(item => {
            if (item.dataset.panel) {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
                    item.classList.add('active');
                    document.getElementById(`${item.dataset.panel}Panel`).classList.add('active');
                    
                    // 切换到班级统计时加载班级列表
                    if (item.dataset.panel === 'classStat') {
                        loadClassList();
                    }
                });
            }
        });

        // 注册功能
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPwd = document.getElementById('regConfirmPwd').value;
            const users = JSON.parse(localStorage.getItem('users'));

            // 验证
            if (username === '') {
                errorMsg.textContent = '用户名不能为空！';
                return;
            }
            if (password.length < 6) {
                errorMsg.textContent = '密码长度不能少于6位！';
                return;
            }
            if (password !== confirmPwd) {
                errorMsg.textContent = '两次输入的密码不一致！';
                return;
            }
            if (users[username]) {
                errorMsg.textContent = '该用户名已存在！';
                return;
            }

            // 保存用户
            users[username] = password;
            localStorage.setItem('users', JSON.stringify(users));
            alert('注册成功！请登录');
            
            // 切换到登录表单
            document.querySelector('.auth-tab[data-tab="login"]').click();
            registerForm.reset();
        });

        // 登录功能
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('users'));

            // 验证
            if (!users[username]) {
                errorMsg.textContent = '用户名不存在！';
                return;
            }
            if (users[username] !== password) {
                errorMsg.textContent = '密码错误！';
                return;
            }

            // 保存当前登录用户
            localStorage.setItem('currentUser', username);
            // 切换到主功能区
            authPanel.style.display = 'none';
            mainContent.style.display = 'block';
            loginForm.reset();
        });

        // 修改密码功能
        changePwdForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const currentUser = localStorage.getItem('currentUser');
            const oldPwd = document.getElementById('oldPassword').value;
            const newPwd = document.getElementById('newPassword').value;
            const confirmNewPwd = document.getElementById('confirmNewPwd').value;
            const users = JSON.parse(localStorage.getItem('users'));

            // 验证
            if (users[currentUser] !== oldPwd) {
                alert('原密码错误！');
                return;
            }
            if (newPwd.length < 6) {
                alert('新密码长度不能少于6位！');
                return;
            }
            if (newPwd !== confirmNewPwd) {
                alert('两次输入的新密码不一致！');
                return;
            }

            // 更新密码
            users[currentUser] = newPwd;
            localStorage.setItem('users', JSON.stringify(users));
            alert('密码修改成功！请重新登录');
            // 退出登录
            logout();
        });

        // 添加成绩功能
        addScoreForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('studentClass').value.trim();
            const subject = document.getElementById('subject').value;
            const score = parseInt(document.getElementById('score').value);
            const scores = JSON.parse(localStorage.getItem('scores'));

            // 验证
            if (name === '' || className === '') {
                alert('学生姓名和班级不能为空！');
                return;
            }
            if (isNaN(score) || score < 0 || score > 100) {
                alert('请输入有效的成绩（0-100）！');
                return;
            }

            // 添加成绩
            scores.push({
                id: Date.now(), // 唯一ID
                name,
                class: className,
                subject,
                score
            });
            localStorage.setItem('scores', JSON.stringify(scores));
            alert('成绩添加成功！');
            addScoreForm.reset();
        });

        // 加载班级列表（用于统计功能）
        function loadClassList() {
            const scores = JSON.parse(localStorage.getItem('scores'));
            const classes = new Set();
            scores.forEach(score => {
                classes.add(score.class);
            });

            // 清空并添加班级选项
            statClassSelect.innerHTML = '<option value="">请选择班级</option>';
            classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                statClassSelect.appendChild(option);
            });
        }

        // 班级成绩统计功能
        statBtn.addEventListener('click', () => {
            const className = statClassSelect.value;
            const scores = JSON.parse(localStorage.getItem('scores'));
            const classScores = scores.filter(score => score.class === className);

            if (classScores.length === 0) {
                alert('该班级暂无成绩数据！');
                statResult.style.display = 'none';
                classScoreBody.innerHTML = '<tr><td colspan="5" style="color: #718096;">该班级暂无成绩数据</td></tr>';
                return;
            }

            // 按科目分组统计
            const subjectStats = {};
            classScores.forEach(score => {
                if (!subjectStats[score.subject]) {
                    subjectStats[score.subject] = {
                        scores: [],
                        count: 0,
                        avg: 0,
                        max: 0,
                        min: 100
                    };
                }
                subjectStats[score.subject].scores.push(score.score);
                subjectStats[score.subject].count++;
            });

            // 计算各科统计数据
            Object.keys(subjectStats).forEach(subject => {
                const stats = subjectStats[subject];
                const sum = stats.scores.reduce((a, b) => a + b, 0);
                stats.avg = (sum / stats.count).toFixed(1);
                stats.max = Math.max(...stats.scores);
                stats.min = Math.min(...stats.scores);
            });

            // 生成统计卡片
            statResult.innerHTML = '';
            Object.keys(subjectStats).forEach((subject, index) => {
                const stats = subjectStats[subject];
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.innerHTML = `
                    <h3>${subject}</h3>
                    <div class="stat-value">${stats.avg}</div>
                    <div class="stat-label">平均分</div>
                    <div style="margin-top: 10px; font-size: 0.9rem;">
                        最高分: ${stats.max} | 最低分: ${stats.min} | 人数: ${stats.count}
                    </div>
                `;
                statResult.appendChild(statItem);
            });
            statResult.style.display = 'flex';

            // 生成班级成绩表格
            classScoreBody.innerHTML = '';
            classScores.forEach((score, index) => {
                const tr = document.createElement('tr');
                let levelClass = 'average';
                if (score.score >= 85) levelClass = 'excellent';
                else if (score.score < 60) levelClass = 'failed';
                
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${score.name}</td>
                    <td>${score.subject}</td>
                    <td>${score.score}</td>
                    <td class="${levelClass}">${getLevel(score.score)}</td>
                `;
                classScoreBody.appendChild(tr);
            });
        });

        // 成绩筛选功能
        filterBtn.addEventListener('click', () => {
            const filterType = document.getElementById('filterType').value;
            const subject = document.getElementById('filterSubject').value;
            const scores = JSON.parse(localStorage.getItem('scores'));

            if (!subject) {
                alert('请选择科目！');
                return;
            }

            // 筛选逻辑
            let filteredScores = [];
            if (filterType === 'excellent') {
                filteredScores = scores.filter(score => score.subject === subject && score.score >= 85);
            } else {
                filteredScores = scores.filter(score => score.subject === subject && score.score < 60);
            }

            // 生成筛选结果表格
            filterResultBody.innerHTML = '';
            if (filteredScores.length === 0) {
                filterResultBody.innerHTML = `<tr><td colspan="5" style="color: #718096;">暂无符合条件的学生</td></tr>`;
                return;
            }

            filteredScores.forEach((score, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${score.name}</td>
                    <td>${score.class}</td>
                    <td>${score.subject}</td>
                    <td class="${filterType}">${score.score}</td>
                `;
                filterResultBody.appendChild(tr);
            });
        });

        // 退出登录功能
        logoutBtn.addEventListener('click', logout);

        function logout() {
            localStorage.removeItem('currentUser');
            mainContent.style.display = 'none';
            authPanel.style.display = 'flex';
            errorMsg.textContent = '';
        }

        // 辅助函数：获取成绩等级
        function getLevel(score) {
            if (score >= 90) return '优秀';
            if (score >= 80) return '良好';
            if (score >= 70) return '中等';
            if (score >= 60) return '及格';
            return '不及格';
        }

        // 页面加载时检查是否已登录
        window.addEventListener('load', () => {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                authPanel.style.display = 'none';
                mainContent.style.display = 'block';
            }
        });
    </script>
</body>
</html>
